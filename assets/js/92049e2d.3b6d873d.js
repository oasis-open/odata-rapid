"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[584],{950:function(e,t,n){n.r(t),n.d(t,{assets:function(){return d},contentTitle:function(){return l},default:function(){return h},frontMatter:function(){return i},metadata:function(){return p},toc:function(){return c}});var a=n(7462),r=n(3366),s=(n(8771),n(3905)),o=["components"],i={id:"batch",title:"Batch Operations"},l=void 0,p={unversionedId:"spec/batch",id:"spec/batch",title:"Batch Operations",description:"RAPID allows wrapping multiple requests into a single batch request.",source:"@site/../docs/spec/rapid-pro-batch.md",sourceDirName:"spec",slug:"/spec/batch",permalink:"/docs/spec/batch",draft:!1,editUrl:"https://github.com/oasis-open/odata-rapid/edit/main/docs/../docs/spec/rapid-pro-batch.md",tags:[],version:"current",frontMatter:{id:"batch",title:"Batch Operations"},sidebar:"docs",previous:{title:"Runtime Service Description",permalink:"/docs/spec/servicedescription"},next:{title:"RSDL Intro",permalink:"/docs/rsdl/rsdl-intro"}},d={},c=[{value:"Basics",id:"basics",level:2},{value:"Error Handling",id:"error-handling",level:2},{value:"Advanced Features",id:"advanced-features",level:2}],u={toc:c};function h(e){var t=e.components,n=(0,r.Z)(e,o);return(0,s.kt)("wrapper",(0,a.Z)({},u,n,{components:t,mdxType:"MDXLayout"}),(0,s.kt)("p",null,"RAPID allows wrapping multiple requests into a single batch request."),(0,s.kt)("h2",{id:"basics"},"Basics"),(0,s.kt)("p",null,"Batch requests are sent to a special resource ",(0,s.kt)("inlineCode",{parentName:"p"},"/$batch"),".\nThe request payload consists of an array of individual requests,\nand the response payload consists of an array of individual responses.\nRequests and responses are correlated via an ",(0,s.kt)("inlineCode",{parentName:"p"},"id")," for each individual request."),(0,s.kt)("table",null,(0,s.kt)("thead",{parentName:"table"},(0,s.kt)("tr",{parentName:"thead"},(0,s.kt)("th",{parentName:"tr",align:null},"Template"),(0,s.kt)("th",{parentName:"tr",align:"left"},"POST {service-root}/\\$batch"))),(0,s.kt)("tbody",{parentName:"table"},(0,s.kt)("tr",{parentName:"tbody"},(0,s.kt)("td",{parentName:"tr",align:null},(0,s.kt)("strong",{parentName:"td"},"Example")),(0,s.kt)("td",{parentName:"tr",align:"left"},"POST ",(0,s.kt)("a",{parentName:"td",href:"http://rapid-pro.org/$batch"},"http://rapid-pro.org/$batch"))))),(0,s.kt)("p",null,(0,s.kt)("strong",{parentName:"p"},"Body:")),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "requests": [\n    {\n      "id": "0",\n      "method": "get",\n      "url": "company"\n    },\n    {\n      "id": "1",\n      "method": "get",\n      "url": "competitors"\n    }\n  ]\n}\n')),(0,s.kt)("p",null,(0,s.kt)("strong",{parentName:"p"},"Result:")),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "responses": [\n    {\n      "id": "0",\n      "status": 200,\n      "body": {\n        "@context": "$metadata#company",\n        "name": "Spacely\'s Space Sprockets",\n        "stockSymbol": "spcly"\n      }\n    },\n    {\n      "id": "1",\n      "status": 200,\n      "body": {\n        "@context": "$metadata#competitors",\n        "value": [\n          {\n            "stockSymbol": "cgswl",\n            "name": "Cogswell\'s Cosmic COGs",\n            "incorporated": "2054-10-04T00:00:00Z"\n          }\n        ]\n      }\n    }\n  ]\n}\n')),(0,s.kt)("h2",{id:"error-handling"},"Error Handling"),(0,s.kt)("p",null,"Batch requests return ",(0,s.kt)("inlineCode",{parentName:"p"},"200 OK")," even if some or all of the individual requests in the batch fail.\nBatch requests only return ",(0,s.kt)("inlineCode",{parentName:"p"},"4xx")," if the batch request body is malformed,\nthe client is not authenticated or lacks authorization for the ",(0,s.kt)("inlineCode",{parentName:"p"},"/$batch")," resource,\nor other reasons not related to individual requests in the batch."),(0,s.kt)("p",null,"If an individual request fails, processing continues with the next request.\nIndividual requests can be processed in any order,\nnot necessarily in the sequence they appear in the batch request."),(0,s.kt)("p",null,(0,s.kt)("strong",{parentName:"p"},"Body:")),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "requests": [\n    {\n      "id": "p-0",\n      "method": "patch",\n      "url": "company/employees/2",\n      "headers": {\n        "if-match": "MjA2My0wNC0wMVQxMzo1NToyNy4xMjM0NTZa"\n      },\n      "body": {\n        "title": "On garden leave"\n      }\n    },\n    {\n      "id": "p-1",\n      "method": "patch",\n      "url": "company/employees/4",\n      "body": {\n        "title": "Junior Digital Index Operator"\n      }\n    }\n  ]\n}\n')),(0,s.kt)("p",null,(0,s.kt)("strong",{parentName:"p"},"Result (some individual requests succeed, some fail):")),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "responses": [\n    {\n      "id": "p-0",\n      "status": 412,\n      "body": {\n        "error": {\n          "code": "INVALID_ETAG",\n          "message": "The ETag provided in the If-Match header was outdated"\n        }\n      }\n    },\n    {\n      "id": "p-1",\n      "status": 204\n    }\n  ]\n}\n')),(0,s.kt)("h2",{id:"advanced-features"},"Advanced Features"),(0,s.kt)("p",null,"Batch requests can be enhanced in many ways:"),(0,s.kt)("ul",null,(0,s.kt)("li",{parentName:"ul"},"Execute individual requests only if preceding requests in the same batch request succeed or fail"),(0,s.kt)("li",{parentName:"ul"},"Reference the result of preceding requests"),(0,s.kt)("li",{parentName:"ul"},"Execute batch requests asynchronously and return individual results as soon as they are available"),(0,s.kt)("li",{parentName:"ul"},"Group operations into atomicity groups that are executed all-or-nothing")),(0,s.kt)("p",null,"See ",(0,s.kt)("a",{parentName:"p",href:"https://docs.oasis-open.org/odata/odata-json-format/v4.01/odata-json-format-v4.01.html#sec_BatchRequestsandResponses"},"Batch Requests and Responses")," for details."))}h.isMDXComponent=!0}}]);